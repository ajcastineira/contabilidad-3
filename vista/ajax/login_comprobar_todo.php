<?phpsession_start();//carga la conexionrequire_once '../../general/conexion.php';//require_once '../../general/myLogger.php';$db = new DbC();//cojemos los parametros $usuario=$_POST["usuario"];$usuarioPass=$_POST["usuarioPass"];$empresa=$_POST["empresa"];$empresaPass=$_POST["empresaPass"];$empresaNueva=$_POST["empresaNueva"];//1-buscamos si existe el usuario$query='SELECT * FROM tbusuarios WHERE strUsuario ="'.$usuario.'" AND strPassword="'.$usuarioPass.'"';$db->conectar($_SESSION['dbContabilidad']);$result=$db->ejecutar($query);$db->desconectar();$OK="OK";$error="ERROR";if(mysql_num_rows($result)>0){    //el usuario y password son correctos, ahora buscamos su perfil//    $query='//            SELECT P.strPuesto//            FROM tbusuarios U,tbperfiles P, tbperfilempleado E//            WHERE U.lngIdEmpleado=E.lngIdEmpleado//            AND P.lngId=E.lngIdPerfil//            AND U.strUsuario="'.$usuario.'" AND U.strPassword="'.$usuarioPass.'"//           ';    $query='            SELECT U.strPuesto            FROM tbusuarios U,tbempleados E            WHERE U.lngIdEmpleado=E.lngIdEmpleado            AND U.strUsuario="'.$usuario.'" AND U.strPassword="'.$usuarioPass.'"           ';    $db->conectar($_SESSION['dbContabilidad']);    $result=$db->ejecutar($query);    $db->desconectar();        if(mysql_num_rows($result)>0){        $row=mysql_fetch_array($result);        //ahora compruebo si es usuario o asesor        //si es usuario ya esta correcta la comprobacion por lo que damos $ok        if(substr($row['strPuesto'],0,6)==='Asesor'){            //es asesor            //comprobamos si ha pulsado el boton 'Nueva Empresa'            if($empresaNueva==='NO'){                //comprobamos los datos de la empresa                $query='SELECT * FROM tbempresas WHERE strNombre="'.$empresa.'" AND strPassword="'.$empresaPass.'"';                $db->conectar($_SESSION['dbContabilidad']);                $result=$db->ejecutar($query);                $db->desconectar();                //si existe la empresa y el password damos ok sino error                if(mysql_num_rows($result)>0){                    $response=$OK;                }else{                    $response=$error;                }            }else{//ha pulsado, es empresa nueva                //devolvemos OK                $response=$OK;            }        }else{            //es usuario por lo que damos el ok            $response=$OK;        }    }else{        $response=$error;    }}else{    $response=$error;}        //devuelvo la respuesta al send que lo envió en la pagina ''echo $response;?>