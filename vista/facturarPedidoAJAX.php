<?php//funcion AJAX que es llamada por 'cobrar_facturas_proceso.php'session_start();require_once '../general/funcionesGenerales.php';require_once '../CN/clsCNContabilidad.php';$clsCNContabilidad=new clsCNContabilidad();$clsCNContabilidad->setStrBD($_SESSION['dbContabilidad']);$clsCNContabilidad->setStrBDCliente($_SESSION['mapeo']);$IdPedido = $_GET['IdPedido'];$fechaHoy = $_GET['fechaHoy'];$IdFactura = $clsCNContabilidad->generarFacturaDePedido($_SESSION['usuario'], $IdPedido, $fechaHoy);//si es false, devuelvo el error$response='NO';if($IdFactura === 'false'){    $response='NO';}else{    //se ha generado la factura correctamente, ahora actualizo en el pedido     //el campo 'FechaProximaFacturaPeriodica'    $varRes = $clsCNContabilidad->PedidoActualizarFechaProximaFactura($IdPedido);    $tipoContador = $clsCNContabilidad->Parametro_general('Tipo Contador',date('Y-m-d H:i:s'),date('Y-m-d H:i:s'));    $datosFactura = $clsCNContabilidad->datosFactura($IdFactura);    //si es false, devuelvo el error    if($varRes === 'NO'){        //el texto varia segun sea para PC o movil        if($_SESSION['navegacion']==='movil'){            $response = "La factura generada es ".$datosFactura['NumFactura'].'.<br/> No se a actualizado la fecha de la proxima factura en el pedido. Para ver factura pulse <a href="../movil/altafactura.php?IdFactura='.$IdFactura.'">aqui</a>';        }else{            $response = "La factura generada es ".$datosFactura['NumFactura'].'. No se a actualizado la fecha de la proxima factura en el pedido. Para ver factura pulse <a href="../vista/altafactura.php?IdFactura='.$IdFactura.'">aqui</a>';        }    }else{        //si todo a ido correctamente devuelvo la factura        //el texto varia segun sea para PC o movil        if($_SESSION['navegacion']==='movil'){            $response = "La factura generada es ".$datosFactura['NumFactura'].'.<br/> Para ver factura pulse <a href="../movil/altafactura.php?IdFactura='.$IdFactura.'">aqui</a>';        }else{            $response = "La factura generada es ".$datosFactura['NumFactura'].'. Para ver factura pulse <a href="../vista/altafactura.php?IdFactura='.$IdFactura.'">aqui</a>';        }    }}echo $response;?>