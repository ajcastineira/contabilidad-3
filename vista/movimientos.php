<?phpsession_start ();require_once '../CN/clsCNContabilidad.php';require_once '../general/funcionesGenerales.php';//Control de SesionControlaLoginTimeOut();//Control de Permisos. Hay que incluirlo en todas las páginas/**************************************************************/$strPagina=dameURL();$strCargo = trim($_SESSION['cargo']);   //Esto es el puesto al que le hacemos un trim$lngPermiso = AccesoUsuarioPagina ($strPagina, $strCargo);  // Le pasamos la página y el cargo. if ($lngPermiso==-1){//Se ha producido un error de base. TENDREMOS QUE PASAR A LA FUNCION ERROR    ControlErrorPermiso();    die;}if ($lngPermiso==0){//El usuario no tiene permisos por tanto mostramos error    ControlAvisoPermiso();    die;}//Si devuelve 1 entonces que siga el flujo /**************************************************************/$clsCNContabilidad=new clsCNContabilidad();$clsCNContabilidad->setStrBD($_SESSION['mapeo']);//prepara una seleccion de las cuentas segun el parametro de entrada que le demos//function CuentasSelect($GRoSUBGR,$valor){////    $clsCNContabilidad=new clsCNContabilidad();////    $clsCNContabilidad->setStrBD($_SESSION['mapeo']);////    $Cuentas=array();////    $Cuentas=$clsCNContabilidad->SelectCuentas($GRoSUBGR,$valor);////    $strHTML="<option></option>";////    for ($i=1;$i<=count($Cuentas);$i++){////        $strHTML =$strHTML."<option value='".$Cuentas[$i]['NumCuenta']."'>".$Cuentas[$i]['cuentas']."</option>";////    }////    return $strHTML;////}////codigo principal//comprobamos si se ha submitido el formulario y que el cliente existeif(isset($_POST['cmdAlta']) && $_POST['cmdAlta']=='Aceptar'){    logger('info','ingresos.php-' ,"Usuario: ".$_SESSION['strUsuario'].', Empresa: '.$_SESSION['base'].', SesionID: '.  session_id().           " ||||Operaciones->Mis Ingresos|| Ha pulsado 'Aceptar'");    $varRes = $clsCNContabilidad->AltaMovimientos($_SESSION["idEmp"],$_POST['strCuenta'], $_POST["lngIngreso"],                                            $_POST['strCuentaCli'], $_POST["lngCantidad"],$_POST["lngIva"], $_POST["datFecha"],                                            $_POST["strPeriodo"], $_POST["lngEjercicio"], $_POST["strConcepto"], $_SESSION["strUsuario"]);           if($varRes<>1){        echo '<META HTTP-EQUIV=Refresh CONTENT="0; URL=../vista/error.php?id='.$varRes.'">';    }else{        echo '<META HTTP-EQUIV=Refresh CONTENT="0; URL=../vista/exito.php">';    }    }else{//comienzo del else principal    logger('info','ingresos.php-' ,"Usuario: ".$_SESSION['strUsuario'].', Empresa: '.$_SESSION['base'].', SesionID: '.  session_id().           " ||||Operaciones->Mis Ingresos||");    ?><!DOCTYPE html><HTML><HEAD><?php//estas funciones son generaleslibrerias_jQuery();eventosInputText();?><meta http-equiv="Content-type" content="text/html; charset=utf-8" /><link rel="shortcut icon" href="../images/q.ico"><TITLE>Alta de Ingresos - Movimientos</TITLE><script language="JavaScript">function validar2(){  esValido=true;  textoError='';    //comprobacion del campo 'strEmpresa'  if (document.form1.strEmpresa.value == ''){     textoError=textoError+"Es necesario introducir el nombre de la empresa.\n";    document.form1.strEmpresa.style.borderColor='#FF0000';    document.form1.strEmpresa.title ='Se debe introducir el nombre de la empresa';    esValido=false;  }  //comprobacion del campo 'strPeriodo'  if (document.form1.strPeriodo.value == ''){     textoError=textoError+"Es necesario introducir el periodo.\n";    document.form1.strPeriodo.style.borderColor='#FF0000';    document.form1.strPeriodo.title ='Se debe introducir el periodo';    esValido=false;  }  //comprobacion del campo 'lngEjercicio'  if (document.form1.lngEjercicio.value == ''){     textoError=textoError+"Es necesario introducir el ejercicio.\n";    document.form1.lngEjercicio.style.borderColor='#FF0000';    document.form1.lngEjercicio.title ='Se deben introducir el ejercicio';    esValido=false;  }  //comprobacion del campo 'datFecha'  if (document.form1.datFecha.value == ''){     textoError=textoError+"Es necesario introducir la fecha del apunte.\n";    document.form1.datFecha.style.borderColor='#FF0000';    document.form1.datFecha.title ='Se debe introducir la fecha del apunte';    esValido=false;  }  //comprobacion del campo 'strCuentaCli'  if (document.form1.strCuentaCli.value == ''){     textoError=textoError+"Es necesario introducir la cuenta del cliente.\n";    document.form1.strCuentaCli.style.borderColor='#FF0000';    document.form1.strCuentaCli.title ='Se debe introducir la cuenta del cliente';    esValido=false;  }  //comprobacion del campo 'strCuenta'  if (document.form1.strCuenta.value == ''){     textoError=textoError+"Es necesario introducir la cuenta de origen.\n";    document.form1.strCuenta.style.borderColor='#FF0000';    document.form1.strCuenta.title ='Se debe introducir la cuenta de origen';    esValido=false;  }  //comprobacion del campo 'strConcepto'  if (document.form1.strConcepto.value == ''){     textoError=textoError+"Es necesario introducir el concepto.\n";    document.form1.strConcepto.style.borderColor='#FF0000';    document.form1.strConcepto.title ='Se debe introducir el concepto';    esValido=false;  }  //comprobacion del campo 'lngIngreso'  if (document.form1.lngIngreso.value == ''){     textoError=textoError+"Es necesario introducir el ingreso.\n";    document.form1.lngIngreso.style.borderColor='#FF0000';    document.form1.lngIngreso.title ='Se debe introducir el ingreso';    esValido=false;  }    //indicar el mensaje de error si es 'esValido' false  if (!esValido){          alert(textoError);  }  if(esValido==true){      document.form1.submit();  }else{      return false;  }  }</script><script language="JavaScript">var txt="-    Sistema de Gestión de la Calidad    ";var espera=120;var refresco=null;function rotulo_status() {        window.status=txt;        txt=txt.substring(1,txt.length)+txt.charAt(0);                refresco=setTimeout("rotulo_status()",espera);        }// --></script><script languaje="JavaScript"  type="text/JavaScript">function Modificar(menu){		document.form1.strTipReclamacion.value = menu.options[menu.selectedIndex].text}</script><SCRIPT LANGUAGE="JavaScript" SRC="../js/valida.js"><!--	alert('Error en el fichero valida.js');// --></SCRIPT><link href="../css/Estilos_Qualidad.css" rel="stylesheet" type="text/css"><link rel="stylesheet" href="../css/calidad2.css" type="text/css"><?php//Funciones generales - carga las funciones auxiliares de eventos de los inputText    eventosInputText();?></HEAD><SCRIPT LANGUAGE="JavaScript">function desactivaBoton() {	if (this.form1.cmdAlta.value == "Anular") {	  alert("Está intentando dar de alta dos veces");  this.form1.strDescripcion.name="";	}else{		this.form1.cmdAlta.value = "Anular";	}}</SCRIPT> <SCRIPT language="JavaScript" SRC="../js/car_valido.js"></SCRIPT><SCRIPT LANGUAGE="JavaScript"><!-- Iniciofunction MakeArrayday(size) {this.length = size;for(var i = 1; i <= size; i++) {this[i] = ""}return this}function funClock() {if (!document.layers && !document.all)return;var runTime = new Date()var hours = runTime.getHours()var minutes = runTime.getMinutes()var seconds = runTime.getSeconds()var dn = "am";if (minutes <= 9) {minutes = "0" + minutes;}if (seconds <= 9) {seconds = "0" + seconds;}movingtime = "<b>"+ hours + ":" + minutes + ":" + seconds + " " +  "</b>";if (document.layers) {document.layers.clock.document.write(movingtime);document.layers.clock.document.close();}else if (document.all) {clock.innerHTML = movingtime;}setTimeout("funClock()", 1000)}window.onload = funClock;//  Fin --></script><SCRIPT LANGUAGE="JavaScript"><!-- Hide from JavaScript-Impaired Browsersfunction initArray() { for(i=0;i<initArray.arguments.length; i++)  this[i] = initArray.arguments[i];}var isnMonths=new initArray("Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre")var isnDays= new initArray("Domingo","Lunes","Martes","Mi&eacute;rcoles","Jueves","Viernes","Sabado","Domingo")today=new Date()hrs=today.getHours()min=today.getMinutes()sec=today.getSeconds()clckh=""clckm=""clcks=""clck=""var stnr=""var ns="0123456789"var a="";// End Hiding --></script><BODY bgColor=#ffffff leftMargin=0 topMargin=0 rightMargin=0 bottomMargin=0 marginwidth="0" marginheight="0"  background="<?php echo FONDO; ?>" onLoad="rotulo_status();"><table border="0" cellpadding="0" cellspacing="0" width="100%"><!-- Cabecera-->  <tr>  <td colspan="2" width="40%" height="100%" border="0" alt=""  ></td>   <td  width="780" height="35" border="0" alt="" bgcolor="#FFFFFF"  class="Text2">   <table border="<?php echo MARCO_BORDER; ?>" cellpadding="0" cellspacing="0" width="780">   <tr>   <!-- contenido pagina -->   <td width="768" height="854" border="0" alt="" valign="top">   <br><p></p><center>    <?php$tituloForm='MOVIMIENTOS<br/>ALTA DE INGRESOS';$paginaForm='';//require_once 'CodFormat.php';//$codFormat=new CodFormat();//$codFormat->setStrBD($_SESSION['dbContabilidad']);//$formatoForm=$codFormat->SelectFormato(60);$formatoForm='';$numeroForm='';$disabledForm='disabled';date_default_timezone_set('Europe/Madrid');$fechaForm=date('d/m/Y');$fechaYear=date('Y');require_once 'cabeceraForm.php';?>  <div class="doc">     <hr color = "#FF9900">    <br/>    <form name="form1" method="post" action="../vista/ingresos.php">	              <table width="640" border="0" class="zonaactiva">        <tr>           <td class="subtitulo" colspan="11">&nbsp;Alta Movimientos - Ingresos</td>        </tr>        <tr>            <td width="15%"></td>            <td width="8%"></td>            <td width="8%"></td>            <td width="8%"></td>            <td width="8%"></td>            <td width="8%"></td>            <td width="8%"></td>            <td width="8%"></td>            <td width="8%"></td>            <td width="8%"></td>            <td width="8%"></td>        </tr>        <tr>           <td colspan="2">              <div align="left">              <label class="nombreCampo">Empresa</label>              <input class="textbox1" type="text" name="strEmpresa" maxlength="50" value="<?php echo $_SESSION['base'];?>"                     onMouseOver="onMouseOverInputText(this);" onMouseOut="onMouseOutInputText(this);" onfocus="onFocusInputText(this);" onblur="onBlurInputText(this);"/>              </div>          </td>          <td></td>          <td colspan="2">              <div align="left">              <label class="nombreCampo">Periodo</label>              <select name="strPeriodo" class="textbox1"                      onMouseOver="onMouseOverInputText(this);" onMouseOut="onMouseOutInputText(this);">                    <option value= "" selected></option>                      <option VALUE = "0">APERTURA</option>                    <option VALUE = "1">ENERO</option>                    <option VALUE = "2">FEBRERO</option>                    <option VALUE = "3">MARZO</option>                    <option VALUE = "4">ABRIL</option>                    <option VALUE = "5">MAYO</option>                    <option VALUE = "6">JUNIO</option>                    <option VALUE = "7">JULIO</option>                    <option VALUE = "8">AGOSTO</option>                    <option VALUE = "9">SEPTIEMBRE</option>                    <option VALUE = "10">OCTUBRE</option>                    <option VALUE = "11">NOVIEMBRE</option>                    <option VALUE = "12">DICIEMBRE</option>                    <option VALUE = "98">CIERRE EJERCICIO</option>                    <option VALUE = "99">CIERRE CONTABLE</option>              </select>              </div>          </td>          <td></td>          <td colspan="2">              <div align="left">              <label class="nombreCampo">Ejercicio</label>              <input class="textbox1" type="text" name="lngEjercicio" maxlength="4"                     onkeypress="javascript:return solonumeros(event);" value="<?php echo $fechaYear;?>"                     onMouseOver="onMouseOverInputText(this);" onMouseOut="onMouseOutInputText(this);" onfocus="onFocusInputText(this);" onblur="onBlurInputText(this);"/>              </div>          </td>          <td></td>                    <td colspan="2">             <div align="left">             <label class="nombreCampo" width="70">Fecha</label>            <?php            datepicker_español('datFecha');            ?>            <style type="text/css">            /* para que no salga el rectangulo inferior */                    .ui-widget-content {                border: 0px solid #AAAAAA;            }            </style>                        <input class="textbox1" type="text" id="datFecha" name="datFecha" maxlength="38" value="<?php echo $fechaForm;?>"                      onMouseOver="onMouseOverInputText(this);" onMouseOut="onMouseOutInputText(this);" onfocus="onFocusInputText(this);" onblur="onBlurInputText(this);" />             </div>          </td>        </tr>                <tr>             <td colspan="3">              <div align="left">              <label class="nombreCampo">Cuenta Cliente<font color="#F0F8FF">...............</font></label>              <select name="strCuentaCli" class="textbox1"                   onMouseOver="onMouseOverInputText(this);" onMouseOut="onMouseOutInputText(this);">                  <?php echo CuentasSelect("SubGrupo4",4300);?>              </select>              </div>          </td>          <td></td>          <td colspan="4">               <div align="left">              <label class="nombreCampo">Cuenta Origen</label>              <select name="strCuenta" class="textbox1"                   onMouseOver="onMouseOverInputText(this);" onMouseOut="onMouseOutInputText(this);">                  <?php echo CuentasSelect("SubGrupo4",7000);?>              </select>              </div>          </td>          <td colspan="2"></td>        </tr>        <tr>          <td colspan="10">              <div align="left">              <label class="nombreCampo">Concepto</label>              <input class="textbox1" type="text" name="strConcepto" maxlength="122"                     onMouseOver="onMouseOverInputText(this);" onMouseOut="onMouseOutInputText(this);" onfocus="onFocusInputText(this);" onblur="onBlurInputText(this);"/>              </div>          </td>        </tr>                <tr>           <td colspan="2">              <div align="left">              <label class="nombreCampo">Ingreso</label>              <input class="textbox1" type="text" name="lngIngreso" maxlength="10" onkeypress="return solonumeros(event);" onkeyUp="CalculaIva(this.value,document.form1.lngPorciento.value);"                     onMouseOver="onMouseOverInputText(this);" onMouseOut="onMouseOutInputText(this);" onfocus="onFocusInputText(this);" onblur="onBlurInputText(this);"/>              </div>          </td>          <td></td>          <td colspan="2">              <div align="left">              <label class="nombreCampo">IVA<font color="#F0F8FF">............................</font></label>              <select name="lngPorciento" onchange="CalculaIva(document.form1.lngIngreso.value,this.value);" class="textbox1"                      onMouseOver="onMouseOverInputText(this);" onMouseOut="onMouseOutInputText(this);">                <option value = "0">  0</option>                <option value = "1">  1</option>                <option value = "2">  2</option>                <option value = "3">  3</option>                <option value = "4">  4</option>                <option value = "5">  5</option>                <option value = "6">  6</option>                <option value = "7">  7</option>                <option value = "8">  8</option>                <option value = "9">  9</option>                <option value = "10"> 10</option>                <option value = "11"> 11</option>                <option value = "12"> 12</option>                <option value = "13"> 13</option>                <option value = "14"> 14</option>                <option value = "15"> 15</option>                <option value = "16"> 16</option>                <option value = "17"> 17</option>                <option value = "18"> 18</option>                <option value = "19"> 19</option>                <option value = "20"> 20</option>                <option value = "21" selected> 21</option>                <option value = "22"> 22</option>                <option value = "23"> 23</option>                <option value = "24"> 24</option>                <option value = "25"> 25</option>              </select>              </div>          </td>          <td></td>          <td colspan="2">              <div align="left">              <label class="nombreCampo">Cantidad</label>              <input class="textbox1" type="text" name="lngCantidad" maxlength="9" readonly />              </div>          </td>          <td></td>          <td colspan="2">              <div align="left">              <label class="nombreCampo">IVA</label>              <input class="textbox1" type="text" name="lngIva" maxlength="4" readonly />              </div>          </td>        </tr>        <tr>            <td height="15px"></td>        </tr>      </table>                      <table width="640" border="0" class="zonaactiva">        <tr>           <td class="subtitulo">&nbsp;Firma</td>          <td class="subtitulo">&nbsp;Fecha</td>        </tr>                <tr>            <td width="70%">                <div align="left">                   <label class="nombreCampo">Rosa Morales</label>                </div>            </td>            <td width="30%">                <div align="left">                   <label class="nombreCampo">                      <?php echo $fechaForm;?>                   </label>                </div>            </td>        </tr>                        <tr>            <td height="15px"></td>        </tr>      </table>              <P>        <input type="Reset" class="button" value="Vaciar Datos" name="cmdReset"/>        <input type="button" class="button" name="cmdAlta" id="cmdAlta" value = "Aceptar" onclick="javascript:validar2();" />         <input type="hidden"  name="cmdAlta" value="Aceptar" /><!--        <input type="hidden"  name="num2" value="" />-->      </P>              <label id="prueba" class="nombreCampo">          <hr color = "#FF9900">Si tiene alguna incidencia con la aplicacion, por favor contacte con nosotros.      </label>      <br>      <a href="../vista/incidencias.php?pag=foralta.php"><img src="../images/CONTACTO.gif" alt="Envío de Incidencias" width="25" height="30" border="0"></a>      <hr  color = "#FF9900">                    </form>  </div></center>   </td>   <!-- contenido pagina -->  </tr>  </table></td>    <td  width="40%" height="100%" border="0" alt=""  ></td>  </tr><!-- presentacion-->   </table></body></html><?php}//fin del else principal?>